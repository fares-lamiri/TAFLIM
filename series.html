<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAFLIM | Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
    <header class="navbar">
        <button id="menu-btn" aria-label="ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©">
            <span></span>
            <span></span>
            <span></span>
        </button>
        
        <div class="search-container">
            <input type="text" id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³Ù„Ø³Ù„...">
            <div id="search-suggestions" class="search-suggestions"></div>
        </div>
        
        <div class="logo">TAFLIM</div>
    </header>

    <!-- Ø·Ø¨Ù‚Ø© Ø§Ù„ØªØ¹ØªÙŠÙ… -->
    <div id="overlay"></div>

    <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
    <div id="sidebar">
        <button id="close-sidebar">Ã—</button>
        <ul>
            <li><a href="index.html" class="sidebar-link">ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
            <li><a href="movies.html" class="sidebar-link">ğŸ¬ Ø§Ù„Ø£ÙÙ„Ø§Ù…</a></li>
            <li><a href="series.html" class="sidebar-link active">ğŸ“º Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª</a></li>
            <li><a href="anime.html" class="sidebar-link">ğŸ‡¯ğŸ‡µ Ø§Ù„Ø£Ù†Ù…ÙŠ</a></li>
        </ul>
    </div>

    <!-- Ø¹Ø±Ø¶ Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ù†Ø´Ø·Ø© -->
    <div id="active-filters" class="active-filters"></div>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ÙÙ„Ø§ØªØ± -->
    <div class="filters-bar">
        <div class="filter-group">
            <button class="filter-btn" data-filter="category">ÙØ¦Ø© Ø§Ù„Ù…Ø³Ù„Ø³Ù„ â–¼</button>
            <div class="filter-dropdown">
                <button data-value="">Ø§Ù„ÙƒÙ„</button>
                <button data-value="foreign">Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø£Ø¬Ù†Ø¨ÙŠØ©</button>
                <button data-value="korean">Ù…Ø³Ù„Ø³Ù„Ø§Øª ÙƒÙˆØ±ÙŠØ©</button>
                <button data-value="turkish">Ù…Ø³Ù„Ø³Ù„Ø§Øª ØªØ±ÙƒÙŠØ©</button>
                <button data-value="arabic">Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø¹Ø±Ø¨ÙŠØ©</button>
                <button data-value="asian">Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø¢Ø³ÙŠÙˆÙŠØ©</button>
                <button data-value="anime">Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø£Ù†Ù…ÙŠ</button>
            </div>
        </div>

        <div class="filter-group">
            <button class="filter-btn" data-filter="genre">Ø§Ù„Ù†ÙˆØ¹ â–¼</button>
            <div class="filter-dropdown">
                <button data-value="">Ø§Ù„ÙƒÙ„</button>
                <button data-value="10759">Ø£ÙƒØ´Ù† ÙˆÙ…ØºØ§Ù…Ø±Ø§Øª</button>
                <button data-value="16">Ø£Ù†ÙŠÙ…ÙŠØ´Ù†</button>
                <button data-value="35">ÙƒÙˆÙ…ÙŠØ¯ÙŠ</button>
                <button data-value="80">Ø¬Ø±ÙŠÙ…Ø©</button>
                <button data-value="99">ÙˆØ«Ø§Ø¦Ù‚ÙŠ</button>
                <button data-value="18">Ø¯Ø±Ø§Ù…Ø§</button>
                <button data-value="10751">Ø¹Ø§Ø¦Ù„ÙŠ</button>
                <button data-value="10762">Ø£Ø·ÙØ§Ù„</button>
                <button data-value="9648">ØºÙ…ÙˆØ¶</button>
                <button data-value="10763">Ø£Ø®Ø¨Ø§Ø±</button>
                <button data-value="10764">ÙˆØ§Ù‚Ø¹ÙŠ</button>
                <button data-value="10765">Ø®ÙŠØ§Ù„ Ø¹Ù„Ù…ÙŠ</button>
                <button data-value="10766">Ø£ÙˆØ¨ÙŠØ±Ø§ ØµØ§Ø¨ÙˆÙ†ÙŠØ©</button>
                <button data-value="10767">ØªÙˆÙƒ Ø´Ùˆ</button>
                <button data-value="10768">Ø­Ø±Ø¨ ÙˆØ³ÙŠØ§Ø³Ø©</button>
                <button data-value="37">ØºØ±Ø¨ÙŠ</button>
            </div>
        </div>

        <div class="filter-group">
            <button class="filter-btn" data-filter="year">Ø³Ù†Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ â–¼</button>
            <div class="filter-dropdown">
                <button data-value="">Ø§Ù„ÙƒÙ„</button>
                <button data-value="2025">2025</button>
                <button data-value="2024">2024</button>
                <button data-value="2023">2023</button>
                <button data-value="2022">2022</button>
                <button data-value="2021">2021</button>
                <button data-value="2020">2020</button>
                <button data-value="older">Ù‚Ø¨Ù„ 2020</button>
            </div>
        </div>

        <div class="filter-group">
            <button class="filter-btn" data-filter="rating">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… â–¼</button>
            <div class="filter-dropdown">
                <button data-value="">Ø§Ù„ÙƒÙ„</button>
                <button data-value="8">+8 â­â­â­â­</button>
                <button data-value="7">+7 â­â­â­</button>
                <button data-value="6">+6 â­â­</button>
                <button data-value="5">+5 â­</button>
            </div>
        </div>
    </div>

    <!-- Ù‚Ø³Ù… Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« -->
    <div class="search-results-section" id="search-results-section">
        <h2 class="results-title">ğŸ” Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª</h2>
        <div class="search-results-header">
            <div class="search-query-container">
                <span class="search-query-label">Ø¨Ø­Ø«Øª Ø¹Ù†:</span>
                <span class="search-query-text" id="search-query-text"></span>
            </div>
            <div class="search-results-count" id="search-results-count"></div>
        </div>
        <div class="search-results-container" id="search-results-container"></div>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div id="main-content"></div>

    <!-- Ø±Ø³Ø§Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
<div style="
width: 100%;
min-height: 180px;
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
text-align: center;
margin-top: 60px;
margin-bottom: 40px;
color: #fff;
">
<div style="font-size: 2.5rem; margin-bottom: 15px;">
    ğŸ“º
</div>
<div style="font-size: 1.2rem; margin-bottom: 10px;">
    ÙˆØµÙ„Øª Ø¥Ù„Ù‰ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ØªØ§Ø­
</div>
<div style="font-size: 0.95rem; color: #888;">
    Ø¬Ø±Ø¨ ØªØºÙŠÙŠØ± Ø§Ù„ÙÙ„Ø§ØªØ± Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª
</div>
</div>
    <!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰ -->
    <button id="back-to-top" class="show">â†‘</button>

    <!-- Ø§Ù„ÙÙˆØªØ± -->
    <footer>
        <div class="footer-content">
            <p>Â© 2025 TAFLIM - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
            <p class="footer-tagline">ğŸ“º ÙˆØ¬Ù‡ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // ========== ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ù„ØºØ§Øª Ø§Ù„Ø°ÙƒÙŠ ==========
        
        // ===== Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© =====
        const TMDB_API = {
            key: "dbb14198ea29a547de77343dc3fe7a37",
            baseURL: "https://api.themoviedb.org/3",
            imageBase: "https://image.tmdb.org/t/p/w500"
        };

        // ===== Ø¹Ù†Ø§ØµØ± DOM =====
        const mainContent = document.getElementById("main-content");
        const searchInput = document.getElementById("search");
        const suggestionsContainer = document.getElementById("search-suggestions");
        const searchResultsSection = document.getElementById("search-results-section");
        const searchQueryText = document.getElementById("search-query-text");
        const searchResultsCount = document.getElementById("search-results-count");
        const searchResultsContainer = document.getElementById("search-results-container");
        const backToTopBtn = document.getElementById("back-to-top");
        const menuBtn = document.getElementById("menu-btn");
        const sidebar = document.getElementById("sidebar");
        const closeSidebar = document.getElementById("close-sidebar");
        const overlay = document.getElementById("overlay");
        const activeFiltersContainer = document.getElementById("active-filters");
        const endOfContent = document.getElementById("end-of-content");

        // ===== Ù…ØªØºÙŠØ±Ø§Øª Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ =====
        let displayedSeries = [];
        let currentPage = 1;
        let filterPage = 1;
        let isLoading = false;
        let hasMoreSeries = true;
        let searchTimer = null;
        let activeSuggestionIndex = -1;
        let isGlobalSearch = false;
        let activeFilters = {};
        let seenSeriesIds = new Set(); // Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±

        // ===== Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ =====
        const smartSearchDictionary = {
            // ÙƒÙˆØ±ÙŠ
            "Ù„Ø¹Ø¨Ø© Ø§Ù„Ø­Ø¨Ø§Ø±": "Squid Game", "Ù‡Ø¨ÙˆØ· Ø§Ø¶Ø·Ø±Ø§Ø±ÙŠ": "Crash Landing on You",
            "Ø§Ù„ØºÙˆØ¨Ù„ÙŠÙ†": "Goblin", "Ø§Ù„Ù…Ø¬Ø¯": "The Glory", "Ø£Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø´Ù…Ø³": "Descendants of the Sun",
            "ÙØ¦Ø© Ø¥ÙŠØªØ§ÙˆÙ†": "Itaewon Class", "Ø§Ù‚ØªØ±Ø§Ø­ Ø¹Ù…Ù„": "Business Proposal",
            "Ù…ÙˆØ·Ù† ØªØ´Ø§ ØªØ´Ø§ ØªØ´Ø§": "Hometown Cha-Cha-Cha", "ÙˆØ±Ø§Ø«ÙŠ Ø§Ù„Ø­Ø¨": "Love in the Moonlight",
            
            // ØªØ±ÙƒÙŠ
            "Ø§Ù„ØªØ£Ø³ÙŠØ³ Ø¹Ø«Ù…Ø§Ù†": "KuruluÅŸ: Osman", "Ø§Ù„Ù‚ÙŠØ§Ù…Ø© Ø£Ø±Ø·ØºØ±Ù„": "DiriliÅŸ: ErtuÄŸrul",
            "Ø§Ù„Ù‚Ø±Ù† Ø§Ù„Ø¹Ø¸ÙŠÙ…": "MuhteÅŸem YÃ¼zyÄ±l", "Ø­Ø¨ Ø£Ø³ÙˆØ¯": "Kara Sevda",
            "Ø§Ù„Ø·Ø§Ø¦Ø± Ø§Ù„Ù…Ø¨ÙƒØ±": "Erkenci KuÅŸ", "Ø§Ù„Ø£Ù…": "Anne", "Ø§Ù„Ø¸Ù„": "GÃ¶lge",
            
            // Ø£Ù†Ù…ÙŠ
            "Ù‡Ø¬ÙˆÙ… Ø§Ù„Ø¹Ù…Ø§Ù„Ù‚Ø©": "Attack on Titan", "Ø³ÙŠÙ Ø§Ù„Ù†Ø§Ø±": "Demon Slayer",
            "Ø¬ÙˆØ¬ÙˆØªØ³Ùˆ ÙƒØ§ÙŠØ³Ù†": "Jujutsu Kaisen", "Ø¨Ø·Ù„ÙŠ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©": "My Hero Academia",
            "ÙˆÙ† Ø¨ÙŠØ³": "One Piece", "Ù†Ø§Ø±ÙˆØªÙˆ": "Naruto", "Ø¯Ø±Ø§ØºÙˆÙ† Ø¨ÙˆÙ„": "Dragon Ball",
            
            // Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø¹Ø§Ù„Ù…ÙŠØ©
            "Ø¨Ø±ÙŠÙƒÙŠÙ†Ø¬ Ø¨Ø§Ø¯": "Breaking Bad", "Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¹Ø±ÙˆØ´": "Game of Thrones",
            "ÙˆÙŠØ³Øª ÙˆÙˆØ±Ù„Ø¯": "Westworld", "Ø§Ù„Ø³Ø§Ø­Ø©": "The Arena", "Ø§Ù„Ø±Ø¬Ù„ Ø§Ù„Ø£Ø®ÙŠØ±": "The Last Man"
        };

        // ===== Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ =====
        function smartTranslateQuery(query) {
            if (!query || query.trim() === "") return query;
            
            const lowerQuery = query.toLowerCase().trim();
            
            for (const [arabic, english] of Object.entries(smartSearchDictionary)) {
                if (lowerQuery.includes(arabic.toLowerCase())) {
                    console.log(`ğŸ”¤ ØªØ­ÙˆÙŠÙ„ "${arabic}" Ø¥Ù„Ù‰ "${english}"`);
                    return english;
                }
            }
            
            return query;
        }

        // ===== Ù†Ø¸Ø§Ù… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ØºØ© ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª =====
        function determineLanguageSettings(originalLanguage) {
            let apiLanguage = 'en-US';
            let titleStrategy = 'english';
            let imageLanguages = 'en,null';
            
            if (originalLanguage === 'ja') {
                apiLanguage = 'ja-JP';
                titleStrategy = 'original';
                imageLanguages = 'ja,null,en';
            } else if (['ar', 'tr', 'ko'].includes(originalLanguage)) {
                apiLanguage = 'ar-SA';
                titleStrategy = 'arabic';
                imageLanguages = 'ar,null,en';
            } else {
                apiLanguage = 'en-US';
                titleStrategy = 'english';
                imageLanguages = 'en,null';
            }
            
            return { apiLanguage, titleStrategy, imageLanguages };
        }

        // ===== Ø¬Ù„Ø¨ ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù Ø§Ù„Ø°ÙƒÙŠØ© =====
        async function getSmartPoster(seriesId, originalLanguage) {
            const { imageLanguages } = determineLanguageSettings(originalLanguage);
            const imageUrl = `${TMDB_API.baseURL}/tv/${seriesId}/images?api_key=${TMDB_API.key}&include_image_language=${imageLanguages}`;
            
            try {
                const response = await fetch(imageUrl);
                if (!response.ok) throw new Error('ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„ØµÙˆØ±');
                
                const imageData = await response.json();
                
                if (imageData.posters && imageData.posters.length > 0) {
                    const posterPath = imageData.posters[0].file_path;
                    return `${TMDB_API.imageBase}${posterPath}`;
                }
            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØµÙˆØ±:", error);
            }
            
            return `${TMDB_API.imageBase}/wwemzKWzjKYJFfCeiB57q3r4Bcm.png`;
        }

        // ===== Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³Ù„Ø³Ù„ Ù…Ø¹ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø°ÙƒÙŠ =====
        async function fetchSmartSeriesData(seriesId, originalLanguage) {
            const { apiLanguage, titleStrategy } = determineLanguageSettings(originalLanguage);
            
            const seriesUrl = `${TMDB_API.baseURL}/tv/${seriesId}?api_key=${TMDB_API.key}&language=${apiLanguage}`;
            
            try {
                const response = await fetch(seriesUrl);
                if (!response.ok) throw new Error('ÙØ´Ù„ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ù„Ø³Ù„');
                
                const seriesData = await response.json();
                let finalTitle = seriesData.name || seriesData.original_name;
                
                // Ø¥Ø°Ø§ Ø·Ù„Ø¨Øª Ù„ØºØ© ÙˆÙ„Ù… ÙŠÙˆØ¬Ø¯ ØªØ±Ø¬Ù…Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
                if ((apiLanguage === 'ar-SA' || apiLanguage === 'ja-JP') && 
                    (!seriesData.name || seriesData.name === seriesData.original_name)) {
                    const englishUrl = `${TMDB_API.baseURL}/tv/${seriesId}?api_key=${TMDB_API.key}&language=en-US`;
                    const englishResponse = await fetch(englishUrl);
                    const englishData = await englishResponse.json();
                    finalTitle = englishData.name || seriesData.original_name;
                }
                
                const posterUrl = await getSmartPoster(seriesId, originalLanguage);
                
                return {
                    id: seriesData.id,
                    name: finalTitle,
                    original_name: seriesData.original_name,
                    poster_path: posterUrl,
                    backdrop_path: seriesData.backdrop_path,
                    overview: seriesData.overview,
                    first_air_date: seriesData.first_air_date,
                    vote_average: seriesData.vote_average,
                    vote_count: seriesData.vote_count,
                    genre_ids: seriesData.genre_ids || [],
                    original_language: seriesData.original_language,
                    popularity: seriesData.popularity,
                    type: "tv"
                };
                
            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ù„Ø³Ù„ Ø§Ù„Ø°ÙƒÙŠ:", error);
                return null;
            }
        }

        // ===== Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ =====
        async function performSmartSearch(query, page = 1) {
            const translatedQuery = smartTranslateQuery(query);
            
            searchQueryText.textContent = query;
            searchResultsSection.classList.add('active');
            mainContent.style.display = 'none';
            endOfContent.classList.remove('show');
            
            searchResultsContainer.innerHTML = `
                <div class="search-no-results">
                    <div class="loading-spinner"></div>
                    <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† "${query}"...</p>
                </div>
            `;
            
            try {
                const searchUrl = `${TMDB_API.baseURL}/search/tv?api_key=${TMDB_API.key}&query=${encodeURIComponent(translatedQuery)}&language=ar-SA&page=${page}`;
                const response = await fetch(searchUrl);
                
                if (!response.ok) throw new Error('ÙØ´Ù„ Ø§Ù„Ø¨Ø­Ø«');
                
                const data = await response.json();
                
                if (!data.results || data.results.length === 0) {
                    searchResultsCount.textContent = "0 Ù†ØªÙŠØ¬Ø©";
                    searchResultsContainer.innerHTML = `
                        <div class="search-no-results">
                            <div>ğŸ”</div>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø« "${query}"</p>
                            <p class="suggestions">Ø¬Ø±Ø¨ ÙƒÙ„Ù…Ø§Øª Ø¨Ø­Ø« Ø£Ø®Ø±Ù‰ Ø£Ùˆ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙ‡Ø¬Ø¦Ø©</p>
                        </div>
                    `;
                    return [];
                }
                
                // ØªØµÙÙŠØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
                const uniqueResults = [];
                const seenIds = new Set();
                
                for (const item of data.results) {
                    if (!item.poster_path) continue;
                    if (seenIds.has(item.id)) continue;
                    
                    seenIds.add(item.id);
                    uniqueResults.push(item);
                }
                
                searchResultsCount.textContent = `${uniqueResults.length} Ù†ØªÙŠØ¬Ø©`;
                
                // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù„ÙƒÙ„ Ù…Ø³Ù„Ø³Ù„
                const processedResults = await Promise.all(
                    uniqueResults.map(async (item) => {
                        const seriesData = await fetchSmartSeriesData(item.id, item.original_language || 'en');
                        return seriesData;
                    })
                );
                
                const validResults = processedResults.filter(item => item !== null);
                
                if (validResults.length === 0) {
                    searchResultsContainer.innerHTML = `
                        <div class="search-no-results">
                            <div>âš ï¸</div>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ØµØ§Ù„Ø­Ø© Ù„Ù„Ø¹Ø±Ø¶</p>
                        </div>
                    `;
                    return [];
                }
                
                return validResults;
                
            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ:", error);
                searchResultsContainer.innerHTML = `
                    <div class="search-no-results">
                        <div>âš ï¸</div>
                        <p>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«</p>
                        <p class="suggestions">ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</p>
                    </div>
                `;
                return [];
            }
        }

        // ===== Ø¹Ø±Ø¶ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø¨Ø­Ø« =====
        async function showSearchSuggestions(query) {
            if (!query || query.trim().length < 2) {
                suggestionsContainer.style.display = 'none';
                activeSuggestionIndex = -1;
                return;
            }
            
            const translatedQuery = smartTranslateQuery(query);
            
            suggestionsContainer.innerHTML = `
                <div class="no-results">
                    <div>ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† "${query}"...</div>
                </div>
            `;
            suggestionsContainer.style.display = 'block';
            
            try {
                const url = `${TMDB_API.baseURL}/search/tv?api_key=${TMDB_API.key}&query=${encodeURIComponent(translatedQuery)}&language=ar-SA&page=1`;
                const response = await fetch(url);
                
                if (!response.ok) return;
                
                const data = await response.json();
                const results = data.results ? data.results.slice(0, 8) : [];
                
                if (results.length === 0) {
                    suggestionsContainer.innerHTML = `
                        <div class="no-results">
                            <div>ğŸ” Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù„Ù€ "${query}"</div>
                        </div>
                    `;
                    return;
                }
                
                suggestionsContainer.innerHTML = '';
                activeSuggestionIndex = -1;
                
                results.forEach((item, index) => {
                    if (!item.poster_path) return;
                    
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.dataset.index = index;
                    
                    const title = item.name || item.original_name || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
                    const year = item.first_air_date ? item.first_air_date.substring(0, 4) : "N/A";
                    
                    const posterUrl = item.poster_path ? 
                        `${TMDB_API.imageBase}${item.poster_path}` : 
                        `${TMDB_API.imageBase}/wwemzKWzjKYJFfCeiB57q3r4Bcm.png`;
                    
                    div.innerHTML = `
                        <img src="${posterUrl}" alt="${title}">
                        <div class="suggestion-info">
                            <div class="suggestion-title">${title}</div>
                            <div class="suggestion-details">ğŸ“º Ù…Ø³Ù„Ø³Ù„ â€¢ ${year}</div>
                        </div>
                    `;
                    
                    div.onclick = async () => {
                        const seriesData = await fetchSmartSeriesData(item.id, item.original_language || 'en');
                        if (seriesData) {
                            showSingleSearchResult(seriesData);
                        }
                    };
                    
                    div.onmouseenter = () => {
                        document.querySelectorAll('.suggestion-item').forEach(s => s.classList.remove('active'));
                        div.classList.add('active');
                        activeSuggestionIndex = index;
                    };
                    
                    suggestionsContainer.appendChild(div);
                });
                
            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª:", error);
            }
        }

        // ===== Ø¹Ø±Ø¶ Ù†ØªÙŠØ¬Ø© Ø¨Ø­Ø« ÙˆØ§Ø­Ø¯Ø© =====
        function showSingleSearchResult(seriesData) {
            searchQueryText.textContent = seriesData.name;
            searchResultsCount.textContent = "1 Ù†ØªÙŠØ¬Ø©";
            searchResultsSection.classList.add('active');
            mainContent.style.display = 'none';
            endOfContent.classList.remove('show');
            searchInput.value = '';
            suggestionsContainer.style.display = 'none';
            
            searchResultsContainer.innerHTML = '';
            const card = createSeriesCard(seriesData);
            searchResultsContainer.appendChild(card);
        }

        // ===== Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ù…Ø³Ù„Ø³Ù„ =====
        function createSeriesCard(series) {
            const card = document.createElement("div");
            card.className = "card";
            
            const title = series.name || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
            const year = series.first_air_date ? series.first_air_date.substring(0, 4) : "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
            const rating = series.vote_average ? series.vote_average.toFixed(1) : "N/A";
            const posterUrl = series.poster_path;
            
            let languageBadge = "";
            let categoryName = "";
            
            if (series.original_language === 'ja') {
                languageBadge = "ğŸ‡¯ğŸ‡µ ÙŠØ§Ø¨Ø§Ù†ÙŠ";
                categoryName = "ÙŠØ§Ø¨Ø§Ù†ÙŠ";
            } else if (series.original_language === 'ar') {
                languageBadge = "ğŸ‡¸ğŸ‡¦ Ø¹Ø±Ø¨ÙŠ";
                categoryName = "Ø¹Ø±Ø¨ÙŠ";
            } else if (series.original_language === 'tr') {
                languageBadge = "ğŸ‡¹ğŸ‡· ØªØ±ÙƒÙŠ";
                categoryName = "ØªØ±ÙƒÙŠ";
            } else if (series.original_language === 'ko') {
                languageBadge = "ğŸ‡°ğŸ‡· ÙƒÙˆØ±ÙŠ";
                categoryName = "ÙƒÙˆØ±ÙŠ";
            } else if (series.original_language === 'zh') {
                languageBadge = "ğŸ‡¨ğŸ‡³ ØµÙŠÙ†ÙŠ";
                categoryName = "ØµÙŠÙ†ÙŠ";
            } else {
                languageBadge = "ğŸ‡ºğŸ‡¸ Ø£Ø¬Ù†Ø¨ÙŠ";
                categoryName = "Ø£Ø¬Ù†Ø¨ÙŠ";
            }
            
            card.innerHTML = `
                <div class="language-badge">${languageBadge}</div>
                <img src="${posterUrl}" alt="${title}" loading="lazy">
                <h3>${title}</h3>
                <div style="padding: 0 12px 12px; display: flex; flex-direction: column; gap: 5px; font-size: 0.8rem;">
                    <div style="display: flex; justify-content: space-between; color: #aaa;">
                        <span>${year}</span>
                        <span>â­ ${rating}</span>
                    </div>
                    <div style="color: #666; text-align: center; font-size: 0.75rem;">
                        ${categoryName}
                    </div>
                </div>
            `;
            
            card.onclick = () => {
                window.location.href = `details.html?type=tv&id=${series.id}`;
            };
            
            return card;
        }

        // ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ =====
        function setupInfiniteScroll() {
            let scrollTimeout;
            
            window.addEventListener('scroll', () => {
                clearTimeout(scrollTimeout);
                
                scrollTimeout = setTimeout(() => {
                    const scrollPosition = window.scrollY + window.innerHeight;
                    const pageHeight = document.documentElement.scrollHeight - 100;
                    
                    if (scrollPosition >= pageHeight * 0.8 && !isLoading && hasMoreSeries) {
                        if (isGlobalSearch) {
                            // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ
                            loadMoreSearchResults();
                        } else if (Object.keys(activeFilters).length > 0) {
                            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ÙÙ„Ø§ØªØ± Ù†Ø´Ø·Ø©
                            loadMoreFilteredSeries();
                        } else {
                            // Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
                            loadMoreSeries();
                        }
                    }
                    
                    backToTopBtn.style.display = window.scrollY > 300 ? "flex" : "none";
                }, 100);
            });
        }

        // ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© =====
        function getDiscoverQueryParams() {
            let params = {
                api_key: TMDB_API.key,
                language: 'en-US',
                page: filterPage,
                sort_by: 'popularity.desc'
            };
            
            // ØªØ·Ø¨ÙŠÙ‚ ÙÙ„Ø§ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ
            if (activeFilters.category) {
                switch(activeFilters.category.value) {
                    case 'foreign':
                        params.with_original_language = 'en';
                        break;
                    case 'arabic':
                        params.with_original_language = 'ar';
                        break;
                    case 'turkish':
                        params.with_original_language = 'tr';
                        break;
                    case 'korean':
                        params.with_original_language = 'ko';
                        break;
                    case 'asian':
                        params.with_original_language = 'ja|zh|th';
                        break;
                    case 'anime':
                        params.with_genres = '16';
                        break;
                }
            }
            
            // ØªØ·Ø¨ÙŠÙ‚ ÙÙ„Ø§ØªØ± Ø§Ù„Ù†ÙˆØ¹
            if (activeFilters.genre) {
                params.with_genres = activeFilters.genre.value;
            }
            
            // ØªØ·Ø¨ÙŠÙ‚ ÙÙ„Ø§ØªØ± Ø§Ù„Ø³Ù†Ø©
            if (activeFilters.year) {
                if (activeFilters.year.value === 'older') {
                    params.first_air_date = { lte: '2019-12-31' };
                } else {
                    params.first_air_date_year = activeFilters.year.value;
                }
            }
            
            // ØªØ·Ø¨ÙŠÙ‚ ÙÙ„Ø§ØªØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
            if (activeFilters.rating) {
                params['vote_average.gte'] = activeFilters.rating.value;
            }
            
            return params;
        }

        // ===== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ =====
        let searchPage = 1;
        let currentSearchQuery = "";
        
        async function loadMoreSearchResults() {
            if (isLoading || !hasMoreSeries) return;
            
            isLoading = true;
            showLoadingIndicator();
            searchPage++;
            
            try {
                const newResults = await performSmartSearch(currentSearchQuery, searchPage);
                
                if (newResults.length > 0) {
                    newResults.forEach(result => {
                        if (!seenSeriesIds.has(result.id)) {
                            seenSeriesIds.add(result.id);
                            const card = createSeriesCard(result);
                            searchResultsContainer.appendChild(card);
                        }
                    });
                } else {
                    hasMoreSeries = false;
                }
            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«:", error);
                hasMoreSeries = false;
            } finally {
                isLoading = false;
                hideLoadingIndicator();
                
                if (!hasMoreSeries) {
                    endOfContent.classList.add('show');
                }
            }
        }

        async function loadMoreSeries() {
            if (isLoading || !hasMoreSeries) return;
            
            isLoading = true;
            showLoadingIndicator();
            currentPage++;
            
            try {
                const url = `${TMDB_API.baseURL}/tv/popular?api_key=${TMDB_API.key}&language=en-US&page=${currentPage}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    const newSeries = await Promise.all(
                        data.results.map(async (series) => {
                            if (seenSeriesIds.has(series.id)) return null;
                            seenSeriesIds.add(series.id);
                            return await fetchSmartSeriesData(series.id, series.original_language);
                        })
                    );
                    
                    const validSeries = newSeries.filter(series => series !== null);
                    
                    if (validSeries.length > 0) {
                        validSeries.forEach(series => {
                            const card = createSeriesCard(series);
                            mainContent.appendChild(card);
                        });
                        displayedSeries = [...displayedSeries, ...validSeries];
                    }
                    
                    hasMoreSeries = currentPage < (data.total_pages || 1);
                } else {
                    hasMoreSeries = false;
                }
            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª:", error);
                hasMoreSeries = false;
            } finally {
                isLoading = false;
                hideLoadingIndicator();
                
                if (!hasMoreSeries) {
                    endOfContent.classList.add('show');
                }
            }
        }

        async function loadMoreFilteredSeries() {
            if (isLoading || !hasMoreSeries) return;
            
            isLoading = true;
            showLoadingIndicator();
            filterPage++;
            
            try {
                const params = getDiscoverQueryParams();
                params.page = filterPage;
                
                const queryString = Object.keys(params)
                    .map(key => {
                        if (typeof params[key] === 'object') {
                            return Object.keys(params[key])
                                .map(subKey => `${key}.${subKey}=${params[key][subKey]}`)
                                .join('&');
                        }
                        return `${key}=${encodeURIComponent(params[key])}`;
                    })
                    .join('&');
                
                const url = `${TMDB_API.baseURL}/discover/tv?${queryString}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    const newSeries = await Promise.all(
                        data.results.map(async (series) => {
                            if (seenSeriesIds.has(series.id)) return null;
                            seenSeriesIds.add(series.id);
                            return await fetchSmartSeriesData(series.id, series.original_language);
                        })
                    );
                    
                    const validSeries = newSeries.filter(series => series !== null);
                    
                    if (validSeries.length > 0) {
                        validSeries.forEach(series => {
                            const card = createSeriesCard(series);
                            mainContent.appendChild(card);
                        });
                        displayedSeries = [...displayedSeries, ...validSeries];
                    }
                    
                    hasMoreSeries = filterPage < (data.total_pages || 1);
                } else {
                    hasMoreSeries = false;
                }
            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©:", error);
                hasMoreSeries = false;
            } finally {
                isLoading = false;
                hideLoadingIndicator();
                
                if (!hasMoreSeries) {
                    endOfContent.classList.add('show');
                }
            }
        }

        // ===== ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ± =====
        async function applyFilters() {
            displayedSeries = [];
            mainContent.innerHTML = '';
            filterPage = 1;
            hasMoreSeries = true;
            endOfContent.classList.remove('show');
            seenSeriesIds.clear();
            
            showLoadingIndicator();
            
            const params = getDiscoverQueryParams();
            const queryString = Object.keys(params)
                .map(key => `${key}=${encodeURIComponent(params[key])}`)
                .join('&');
            
            const url = `${TMDB_API.baseURL}/discover/tv?${queryString}`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    const series = await Promise.all(
                        data.results.map(async (tv) => {
                            seenSeriesIds.add(tv.id);
                            return await fetchSmartSeriesData(tv.id, tv.original_language);
                        })
                    );
                    
                    const validSeries = series.filter(tv => tv !== null);
                    
                    if (validSeries.length > 0) {
                        validSeries.forEach(tv => {
                            const card = createSeriesCard(tv);
                            mainContent.appendChild(card);
                        });
                        displayedSeries = validSeries;
                    }
                    
                    hasMoreSeries = filterPage < (data.total_pages || 1);
                    
                    searchResultsSection.classList.remove('active');
                    mainContent.style.display = 'grid';
                    isGlobalSearch = false;
                    
                    updateActiveFiltersDisplay();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    mainContent.innerHTML = `
                        <div class="search-no-results" style="grid-column:1/-1;">
                            <div style="font-size: 3rem; margin-bottom: 20px;">ğŸ”</div>
                            <div style="font-size: 1.2rem; margin-bottom: 10px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</div>
                            <div style="color: #888;">Ø¬Ø±Ø¨ ØªØºÙŠÙŠØ± Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙ„Ø§ØªØ± Ù…Ø®ØªÙ„ÙØ©</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±:", error);
                mainContent.innerHTML = `
                    <div class="search-no-results" style="grid-column:1/-1;">
                        <div style="font-size: 3rem; margin-bottom: 20px;">âš ï¸</div>
                        <div style="font-size: 1.2rem; margin-bottom: 10px;">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±</div>
                        <div style="color: #888;">ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</div>
                    </div>
                `;
            }
            
            hideLoadingIndicator();
        }

        // ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø« =====
        function setupSearch() {
            if (!searchInput) return;
            
            // Ø§Ù„Ø¨Ø­Ø« Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©
            searchInput.addEventListener('input', () => {
                clearTimeout(searchTimer);
                
                const query = searchInput.value.trim();
                currentSearchQuery = query;
                
                if (query.length >= 2) {
                    showSearchSuggestions(query);
                } else {
                    suggestionsContainer.style.display = 'none';
                }
                
                searchTimer = setTimeout(async () => {
                    if (query.length === 0) {
                        searchResultsSection.classList.remove('active');
                        mainContent.style.display = 'grid';
                        endOfContent.classList.remove('show');
                        isGlobalSearch = false;
                        searchPage = 1;
                        return;
                    }
                    
                    isGlobalSearch = true;
                    searchPage = 1;
                    seenSeriesIds.clear();
                    
                    const results = await performSmartSearch(query, searchPage);
                    
                    if (results.length > 0) {
                        searchResultsContainer.innerHTML = '';
                        results.forEach(result => {
                            seenSeriesIds.add(result.id);
                            const card = createSeriesCard(result);
                            searchResultsContainer.appendChild(card);
                        });
                        hasMoreSeries = true;
                    }
                }, 500);
            });
            
            // Ø§Ù„ØªÙ†Ù‚Ù„ ÙÙŠ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
            searchInput.addEventListener('keydown', (e) => {
                const items = suggestionsContainer.querySelectorAll('.suggestion-item');
                if (items.length === 0) return;
                
                switch(e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        activeSuggestionIndex = (activeSuggestionIndex + 1) % items.length;
                        updateActiveSuggestion(items);
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        activeSuggestionIndex = (activeSuggestionIndex - 1 + items.length) % items.length;
                        updateActiveSuggestion(items);
                        break;
                    case 'Enter':
                        if (activeSuggestionIndex >= 0) {
                            e.preventDefault();
                            items[activeSuggestionIndex].click();
                        } else {
                            searchInput.blur();
                        }
                        break;
                    case 'Escape':
                        suggestionsContainer.style.display = 'none';
                        break;
                }
            });
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
            document.addEventListener('click', (e) => {
                if (!searchInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                    suggestionsContainer.style.display = 'none';
                }
            });
        }

        function updateActiveSuggestion(items) {
            items.forEach((item, index) => {
                item.classList.remove('active');
                if (index === activeSuggestionIndex) {
                    item.classList.add('active');
                    item.scrollIntoView({ block: 'nearest' });
                }
            });
        }

        // ===== Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙÙ„Ø§ØªØ± =====
        function setupFilters() {
            document.querySelectorAll('.filter-dropdown button').forEach(item => {
                item.onclick = (e) => {
                    const dropdown = item.closest('.filter-dropdown');
                    if (dropdown) {
                        dropdown.querySelectorAll('button').forEach(b => b.classList.remove('active'));
                        item.classList.add('active');
                        
                        const filterType = dropdown.closest('.filter-group')?.querySelector('.filter-btn')?.dataset.filter;
                        const value = item.dataset.value || "";
                        const displayText = item.textContent;
                        
                        if (value === "") {
                            delete activeFilters[filterType];
                        } else {
                            activeFilters[filterType] = { value, displayText };
                        }
                        
                        dropdown.classList.remove('active');
                        const filterBtn = item.closest('.filter-group')?.querySelector('.filter-btn');
                        if (filterBtn) filterBtn.classList.remove('active');
                        
                        applyFilters();
                        e.stopPropagation();
                    }
                };
            });
        }

        function updateActiveFiltersDisplay() {
            if (!activeFiltersContainer) return;
            
            activeFiltersContainer.innerHTML = '';
            const activeCount = Object.keys(activeFilters).length;
            
            if (activeCount === 0) {
                activeFiltersContainer.style.display = 'none';
                return;
            }
            
            activeFiltersContainer.style.display = 'flex';
            
            const clearBtn = document.createElement('button');
            clearBtn.className = 'clear-all';
            clearBtn.textContent = 'ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„';
            clearBtn.onclick = clearAllFilters;
            activeFiltersContainer.appendChild(clearBtn);
            
            for (const [type, filter] of Object.entries(activeFilters)) {
                if (!filter || !filter.value) continue;
                
                const tag = document.createElement('div');
                tag.className = 'filter-tag';
                
                const icons = { category: 'ğŸ“', genre: 'ğŸ­', year: 'ğŸ“…', rating: 'â­' };
                const icon = icons[type] || 'ğŸ·ï¸';
                
                tag.innerHTML = `<span>${icon} ${filter.displayText}</span><span class="remove" data-type="${type}">Ã—</span>`;
                tag.querySelector('.remove').onclick = (e) => {
                    e.stopPropagation();
                    removeFilter(type);
                };
                
                activeFiltersContainer.appendChild(tag);
            }
        }

        function removeFilter(type) {
            delete activeFilters[type];
            
            const filterBtn = document.querySelector(`.filter-btn[data-filter="${type}"]`);
            const dropdown = filterBtn.nextElementSibling;
            dropdown.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
            dropdown.querySelector('button[data-value=""]').classList.add('active');
            
            applyFilters();
        }

        function clearAllFilters() {
            document.querySelectorAll('.filter-dropdown').forEach(dropdown => {
                dropdown.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                dropdown.querySelector('button[data-value=""]').classList.add('active');
            });
            
            activeFilters = {};
            displayedSeries = [];
            mainContent.innerHTML = '';
            currentPage = 1;
            filterPage = 1;
            hasMoreSeries = true;
            endOfContent.classList.remove('show');
            seenSeriesIds.clear();
            
            loadInitialSeries();
            updateActiveFiltersDisplay();
        }

        // ===== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© =====
        function showLoadingIndicator() {
            const existingIndicator = document.querySelector('.loading-indicator');
            if (!existingIndicator) {
                const indicator = document.createElement('div');
                indicator.className = 'loading-indicator';
                indicator.style.display = 'block';
                indicator.innerHTML = `
                    <div class="loading-spinner"></div>
                    <div>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª...</div>
                `;
                mainContent.appendChild(indicator);
            }
        }

        function hideLoadingIndicator() {
            const indicator = document.querySelector('.loading-indicator');
            if (indicator) {
                indicator.style.display = 'none';
            }
        }

        // ===== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© =====
        async function loadInitialSeries() {
            showLoadingIndicator();
            
            try {
                const url = `${TMDB_API.baseURL}/tv/popular?api_key=${TMDB_API.key}&language=en-US&page=1`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    const series = await Promise.all(
                        data.results.map(async (tv) => {
                            seenSeriesIds.add(tv.id);
                            return await fetchSmartSeriesData(tv.id, tv.original_language);
                        })
                    );
                    
                    const validSeries = series.filter(tv => tv !== null);
                    
                    if (validSeries.length > 0) {
                        validSeries.forEach(tv => {
                            const card = createSeriesCard(tv);
                            mainContent.appendChild(card);
                        });
                        displayedSeries = validSeries;
                        hasMoreSeries = true;
                    }
                }
            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©:", error);
                mainContent.innerHTML = `
                    <div class="search-no-results" style="grid-column:1/-1;">
                        <div style="font-size: 3rem; margin-bottom: 20px;">âš ï¸</div>
                        <div style="font-size: 1.2rem; margin-bottom: 10px;">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª</div>
                        <div style="color: #888;">ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</div>
                        <button onclick="location.reload()" style="
                            margin-top: 20px;
                            padding: 10px 20px;
                            background: var(--accent);
                            color: white;
                            border: none;
                            border-radius: 8px;
                            cursor: pointer;
                            font-family: inherit;
                        ">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
                    </div>
                `;
            }
            
            hideLoadingIndicator();
        }

        // ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬Ø§Ù†Ø¨ÙŠØ© =====
        function setupSidebar() {
            if (!menuBtn || !sidebar || !overlay || !closeSidebar) return;
            
            menuBtn.onclick = (e) => { 
                e.stopPropagation();
                sidebar.classList.add("show"); 
                overlay.classList.add("show"); 
            };
            
            closeSidebar.onclick = (e) => { 
                e.stopPropagation();
                sidebar.classList.remove("show"); 
                overlay.classList.remove("show"); 
            };
            
            overlay.onclick = (e) => { 
                if (e.target === overlay) {
                    sidebar.classList.remove("show"); 
                    overlay.classList.remove("show"); 
                }
            };
            
            document.querySelectorAll('#sidebar a').forEach(link => {
                link.addEventListener('click', () => {
                    sidebar.classList.remove("show");
                    overlay.classList.remove("show");
                });
            });
        }

        function setupBackToTop() {
            if (!backToTopBtn) return;
            
            backToTopBtn.addEventListener("click", () => {
                window.scrollTo({ top: 0, behavior: "smooth" });
            });
        }

        // ===== Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© =====
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.onclick = (e) => {
                const dropdown = btn.nextElementSibling;
                const isActive = dropdown.classList.contains('active');

                document.querySelectorAll('.filter-dropdown').forEach(d => d.classList.remove('active'));
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));

                if (!isActive) {
                    dropdown.classList.add('active');
                    btn.classList.add('active');
                }
                e.stopPropagation();
            };
        });

        document.addEventListener('click', () => {
            document.querySelectorAll('.filter-dropdown').forEach(d => d.classList.remove('active'));
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        });

        // ===== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ =====
        async function initApp() {
            console.log("ğŸ“º ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª ÙŠØ¹Ù…Ù„...");
            console.log("ğŸ”¤ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù…ÙØ¹Ù‘Ù„");
            console.log("ğŸŒ Ù†Ø¸Ø§Ù… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ØºØ© ÙˆØ§Ù„ØµÙˆØ± Ø§Ù„Ø°ÙƒÙŠ Ø¬Ø§Ù‡Ø²");
            
            setupSidebar();
            setupBackToTop();
            setupInfiniteScroll();
            setupFilters();
            setupSearch();
            
            await loadInitialSeries();
            
            console.log("âœ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…");
        }

        // Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>